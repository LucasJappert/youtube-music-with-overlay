<div class="overlay paused draggable">
    <div class="image-container">
        <img src="" alt="Cover Art" class="cover-art">
    </div>

    <div class="info">
        <div class="bg-semi-transparent">
            <div class="song-title">Title</div>
            <div class="artist">Artist</div>
        </div>

        <div class="progress-container bg-semi-transparent">
            <span class="time current-time">0:00</span>
            <div class="equalizer">
                <div style="--i:1;"></div>
                <div style="--i:2;"></div>
                <div style="--i:3;"></div>
                <div style="--i:4;"></div>
                <div style="--i:5;"></div>
                <div style="--i:6;"></div>
                <div style="--i:7;"></div>
                <div style="--i:8;"></div>
                <div style="--i:9;"></div>
                <div style="--i:10;"></div>
                <div style="--i:11;"></div>
                <div style="--i:12;"></div>
                <div style="--i:13;"></div>
                <div style="--i:14;"></div>
                <div style="--i:15;"></div>
                <div style="--i:16;"></div>
                <div style="--i:17;"></div>
            </div>
            <span class="time total-time">0:00</span>

            <div class="w-100 progress-bar-container">
                <div class="progress-bar"></div>
            </div>
        </div>
    </div>
    <!-- <div class="resizable" id="resizer"></div> -->
</div>

<script>
    const equalizerBars = document.querySelectorAll('.equalizer div');
    let interval;
    // Función para actualizar la altura de las barras con un valor aleatorio
    function updateBars() {
        equalizerBars.forEach((bar) => {
            const randomHeight = Math.floor(Math.random() * 20) + 4; // Altura aleatoria entre 4px y 100px
            bar.style.height = randomHeight + 'px';
            const randomDuration = Math.random() * 0.3 + 0.2; // Duración aleatoria entre 0.5s y 2s
            bar.style.transition = `height ${randomDuration}s ease`; // Transición suave
        });
    }
    // Función para pausar las barras (ajustarlas a la altura mínima)
    function pauseEqualizer() {
        clearInterval(interval);
        equalizerBars.forEach((bar) => {
            bar.style.height = '4px'; // Ajusta todas las barras a la altura mínima
        });
    }
    // Función para iniciar el ecualizador (simulación de la música reproduciéndose)
    function startEqualizer() {
        interval = setInterval(updateBars, 300); // Actualiza cada 500ms
    }

    let musicIsPlaying = false;
    window.electronAPI.onUpdateOverlay((event, musicInfo) => {
        const titleElement = document.querySelector('.song-title');
        const artistElement = document.querySelector('.artist');

        if (musicInfo.title) {
            titleElement.textContent = musicInfo.title;
            artistElement.textContent = musicInfo.artistAlbum;
        } else {
            // Mostrar esqueleto cuando no hay título
            titleElement.textContent = ''; // Vaciar contenido
            artistElement.textContent = ''; // Vaciar contenido
        }

        document.querySelector('.cover-art').src = musicInfo.thumbnail || 'default_thumbnail.png';

        const [currentTime, totalTime] = musicInfo.timeInfo.split(' de ');
        document.querySelector('.current-time').textContent = currentTime || '0:00';
        document.querySelector('.total-time').textContent = totalTime || '0:00';

        const overlay = document.querySelector('.overlay');
        if (musicInfo.isPlaying && !musicIsPlaying) {
            musicIsPlaying = true;
            startEqualizer();
        }
        if (!musicInfo.isPlaying && musicIsPlaying) {
            musicIsPlaying = false;
            pauseEqualizer();
        }

        const currentTimeInSeconds = convertToSeconds(currentTime);
        const totalTimeInSeconds = convertToSeconds(totalTime);
        const progressPercentage = (currentTimeInSeconds / totalTimeInSeconds) * 100;
        document.querySelector('.progress-bar').style.width = `${progressPercentage}%`;
    });

    // Helper function para convertir "mm:ss" a segundos
    function convertToSeconds(timeString) {
        const [minutes, seconds] = timeString.split(':').map(Number);
        return minutes * 60 + seconds;
    }

    // Función para actualizar el valor del ancho del contenedor dinámicamente
    function updateContainerWidth() {
        const containerWidth = document.querySelector('.info').offsetWidth;
        const titleElement = document.querySelector('.song-title');
        titleElement.style.setProperty('--container-width', `${containerWidth}px`);
    }

    // Ejecutar al cargar la página
    updateContainerWidth();

    // Actualizar cuando se redimensiona la ventana
    window.addEventListener('resize', updateContainerWidth);

    const overlayWindow = remote.getCurrentWindow();
    const resizer = document.getElementById('resizer');

    resizer.addEventListener('mousedown', (e) => {
        e.preventDefault();
        window.addEventListener('mousemove', resizeWindow);
        window.addEventListener('mouseup', stopResizeWindow);
    });

    function resizeWindow(e) {
        overlayWindow.setSize(e.clientX, e.clientY);
    }

    function stopResizeWindow() {
        window.removeEventListener('mousemove', resizeWindow);
        window.removeEventListener('mouseup', stopResizeWindow);
    }
</script>

<style>
    :root {
        --color1: #00c8ff;
        --color2: #df01f8;
        --shadow-size: 15px;
        --offset: 5px;
    }

    /* quitamos las barras de scroll */
    ::-webkit-scrollbar {
        display: none;
    }

    * {
        box-sizing: border-box;
    }

    body {
        background: transparent;
        color: white;
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        box-sizing: border-box;
        position: relative;
    }

    .overlay {
        display: flex;
        align-items: center;
        padding: 10px;
        /* box-shadow: 0 0 10px #000000; */
        width: 100%;
        border-radius: 15px;
        position: relative;
        animation: rotate-shadow 10s infinite linear;
    }

    .draggable {
        -webkit-app-region: drag;
    }

    .image-container {
        width: 20%;
        height: 90px;
        overflow: hidden;
        border-radius: 10px;
    }

    .cover-art {
        width: 100%;
        height: 100%;
        object-fit: cover;
        object-position: center;
    }

    .info {
        width: 80%;
        flex-grow: 1;
        min-width: 0;
        overflow: hidden;
        padding-left: 10px;
    }

    .song-title,
    .artist {
        width: 100%;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        display: inline-block;
    }

    .song-title {
        font-size: 18px;
        font-weight: bold;
        color: #00FFC6;
        text-shadow: 0 0 5px #00FFC6;
        margin-bottom: 5px;
        padding: 0 5px;
    }

    .artist {
        font-size: 14px;
        color: #FFFFFF;
        opacity: 0.9;
    }

    .bg-semi-transparent {
        background-color: #052e44f0;
        border-radius: 10px;
        padding: 5px 10px;
    }

    .progress-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        width: 100%;
        margin-top: 5px;
    }

    .time {
        font-size: 12px;
        color: #FFFFFF;
        opacity: 0.8;
    }

    .equalizer {
        display: flex;
        justify-content: space-around;
        align-items: center;
        gap: 3px;
        flex-grow: 1;
        max-width: 100%;
        height: 20px;
        padding: 0 20px;
    }

    .equalizer div {
        background-color: var(--color2);
        height: 3px;
        /* Altura mínima inicial */
        transition: height 0.5s ease;
        /* Transición suave cuando cambia la altura */
        display: inline-block;
        border-radius: 5px;
        width: 8px;
        /* box-shadow: 0 0 5px #FF69B4, 0 0 5px #FF69B4; */
    }

    .resizable {
        position: absolute;
        width: 10px;
        height: 10px;
        bottom: 0;
        right: 0;
        cursor: se-resize;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
    }

    .w-100 {
        width: 100% !important;
    }


    .progress-bar-container {
        height: 5px;
        width: 100%;
        background-color: #036a53;
        border-radius: 5px;
        position: relative;
        /* overflow: hidden; */
        margin-top: 5px;
    }

    .progress-bar {
        height: 100%;
        width: 0%;
        /* Inicialmente sin progreso */
        background-color: #00FFC6;
        /* Rosa neón para el progreso */
        box-shadow: 0 0 10px #00FFC6;
        /* Efecto de brillo */
        border-radius: 5px;
        transition: width 0.2s ease;
        /* Suaviza la transición del progreso */
    }

    @keyframes rotate-shadow {
        0% {
            box-shadow: 0 0 var(--shadow-size) var(--color1),
                0 0 var(--shadow-size) var(--color2),
                calc(var(--offset) * -1) calc(var(--offset) * -1) var(--shadow-size) var(--color1),
                var(--offset) var(--offset) var(--shadow-size) var(--color2);
        }

        25% {
            box-shadow: calc(var(--offset) * -1) var(--offset) var(--shadow-size) var(--color1),
                var(--offset) calc(var(--offset) * -1) var(--shadow-size) var(--color2);
        }

        50% {
            box-shadow: var(--offset) var(--offset) var(--shadow-size) var(--color2),
                calc(var(--offset) * -1) calc(var(--offset) * -1) var(--shadow-size) var(--color1);
        }

        75% {
            box-shadow: var(--offset) calc(var(--offset) * -1) var(--shadow-size) var(--color2),
                calc(var(--offset) * -1) var(--offset) var(--shadow-size) var(--color1);
        }

        100% {
            box-shadow: 0 0 var(--shadow-size) var(--color1),
                0 0 var(--shadow-size) var(--color2),
                calc(var(--offset) * -1) calc(var(--offset) * -1) var(--shadow-size) var(--color1),
                var(--offset) var(--offset) var(--shadow-size) var(--color2);
        }
    }
</style>